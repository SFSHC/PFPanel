name: Build and Release Executable

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-linux:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller

      - name: Build executable with PyInstaller
        run: |
          pyinstaller pfpanel.spec

      - name: Upload executable artifact (for workflow) # ä¿ç•™ä¸Šä¼  Artifact æ­¥éª¤
        uses: actions/upload-artifact@v4
        with:
          name: pfpanel-linux-executable
          path: dist/pfpanel

      - name: Create or Update Release # åˆ›å»ºæˆ–æ›´æ–° GitHub Release (ä½¿ç”¨ softprops/action-gh-release)
        uses: softprops/action-gh-release@v1 #  æ›¿æ¢ä¸º softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v1.5 # Release æ ‡ç­¾ä¸º v1.5 (ç¡¬ç¼–ç )
          name: Polyfield Server Panel v1.5 # Release åç§° (ç¡¬ç¼–ç )
          body: |
            ğŸ‰ æ„Ÿè°¢ä½¿ç”¨ Polyfield Server Panel v1.5ï¼ğŸ‰

            æœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†æœ€æ–°æ„å»ºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«ä»¥ä¸‹æ”¹è¿› (å…·ä½“æ›´æ–°å†…å®¹è¯·å‚è€ƒä»£ç æäº¤è®°å½•)ï¼š

            * âœ¨ æœ€æ–°å¯æ‰§è¡Œæ–‡ä»¶ç‰ˆæœ¬ï¼š  ç°åœ¨æ‚¨å¯ä»¥ç›´æ¥ä¸‹è½½é¢„ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ— éœ€é…ç½® Python ç¯å¢ƒï¼Œä¸€é”®å¯åŠ¨æ§åˆ¶é¢æ¿ï¼
            * ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼š  å¯èƒ½åŒ…å«æ€§èƒ½ä¼˜åŒ–ï¼Œæå‡æ§åˆ¶é¢æ¿çš„è¿è¡Œæ•ˆç‡ã€‚
            * ğŸ› Bug ä¿®å¤ï¼š  å¯èƒ½ä¿®å¤äº†ä¸€äº› Bugï¼Œæå‡äº†ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚
            * ğŸ“ æ–‡æ¡£æ›´æ–°ï¼š  æ–‡æ¡£å¯èƒ½è¿›è¡Œäº†æ›´æ–°ï¼Œæä¾›äº†æ›´å®Œå–„çš„ä½¿ç”¨è¯´æ˜ã€‚

            æ„Ÿè°¢ SFSHC from AVDæˆ˜é˜Ÿçš„æŒç»­ç»´æŠ¤ï¼  å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰ä»»ä½•å»ºè®®ï¼Œæ¬¢è¿åœ¨ GitHub Issues ä¸­åé¦ˆã€‚

            **ä¸‹è½½é“¾æ¥ï¼š**  è¯·åœ¨ Assets ä¸­ä¸‹è½½ `pfpanel-linux-executable.zip` æ–‡ä»¶ã€‚

            æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ˜Š
          draft: false
          prerelease: false
          files: dist/pfpanel.zip # **é‡è¦ï¼šç›´æ¥åœ¨ Create Release æ­¥éª¤ä¸­ä¸Šä¼  Asset**
          fail_if_exists: false # **æ–°å¢ï¼šå¦‚æœ Release å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–° Releaseï¼Œè€Œä¸æ˜¯å¤±è´¥**

      - name: Zip executable for release # å°†å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©æˆ zip åŒ… (ä¸å†éœ€è¦å•ç‹¬çš„ Upload Release Asset æ­¥éª¤)
        run: |
          cd dist
          zip -r pfpanel.zip pfpanel # å°† dist/pfpanel æ–‡ä»¶å¤¹å‹ç¼©æˆ pfpanel.zip
