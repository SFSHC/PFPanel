name: Build and Release Executable

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ "main" ] # å½“ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  pull_request:
    branches: [ "main" ] # å½“ pull request ç›®æ ‡åˆ†æ”¯ä¸º main æ—¶è§¦å‘

jobs:
  build-linux:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller

      - name: Build executable with PyInstaller
        run: |
          pyinstaller pfpanel.spec

      - name: Upload executable artifact (for workflow) # ä¿ç•™ä¸Šä¼  Artifact æ­¥éª¤ï¼Œæ–¹ä¾¿ workflow ä¸‹è½½
        uses: actions/upload-artifact@v4
        with:
          name: pfpanel-linux-executable
          path: dist/pfpanel

      - name: Create Release # åˆ›å»º GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v1.5 # Release æ ‡ç­¾ä¸º v1.5 (ç¡¬ç¼–ç )
          release_name: Polyfield Server Panel v1.5 # Release åç§° (ç¡¬ç¼–ç )
          body: |
            ğŸ‰ æ„Ÿè°¢ä½¿ç”¨ Polyfield Server Panel v1.5ï¼ğŸ‰

            æœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†æœ€æ–°æ„å»ºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«ä»¥ä¸‹æ”¹è¿› (å…·ä½“æ›´æ–°å†…å®¹è¯·å‚è€ƒä»£ç æäº¤è®°å½•)ï¼š

            * âœ¨ æœ€æ–°å¯æ‰§è¡Œæ–‡ä»¶ç‰ˆæœ¬ï¼š  ç°åœ¨æ‚¨å¯ä»¥ç›´æ¥ä¸‹è½½é¢„ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ— éœ€é…ç½® Python ç¯å¢ƒï¼Œä¸€é”®å¯åŠ¨æ§åˆ¶é¢æ¿ï¼
            * ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼š  å¯èƒ½åŒ…å«æ€§èƒ½ä¼˜åŒ–ï¼Œæå‡æ§åˆ¶é¢æ¿çš„è¿è¡Œæ•ˆç‡ã€‚
            * ğŸ› Bug ä¿®å¤ï¼š  å¯èƒ½ä¿®å¤äº†ä¸€äº› Bugï¼Œæå‡äº†ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚
            * ğŸ“ æ–‡æ¡£æ›´æ–°ï¼š  æ–‡æ¡£å¯èƒ½è¿›è¡Œäº†æ›´æ–°ï¼Œæä¾›äº†æ›´å®Œå–„çš„ä½¿ç”¨è¯´æ˜ã€‚

            æ„Ÿè°¢ SFSHC from AVDæˆ˜é˜Ÿçš„æŒç»­ç»´æŠ¤ï¼  å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰ä»»ä½•å»ºè®®ï¼Œæ¬¢è¿åœ¨ GitHub Issues ä¸­åé¦ˆã€‚

            **ä¸‹è½½é“¾æ¥ï¼š**  è¯·åœ¨ Assets ä¸­ä¸‹è½½ `pfpanel-linux-executable.zip` æ–‡ä»¶ã€‚

            æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼ğŸ˜Š
          draft: false #  è®¾ç½®ä¸º falseï¼Œå‘å¸ƒæ­£å¼ Release
          prerelease: false # è®¾ç½®ä¸º falseï¼Œä¸æ˜¯é¢„å‘å¸ƒç‰ˆæœ¬
          overwrite: true # **æ–°å¢ï¼šå…è®¸è¦†ç›–å·²å­˜åœ¨çš„ Release**

      - name: Upload Release Asset # ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶åˆ° Release
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create-release.outputs.upload_url }} # ä» Create Release æ­¥éª¤è·å–ä¸Šä¼  URL
          asset_path: dist/pfpanel.zip #  **é‡è¦ï¼šéœ€è¦å…ˆå°†å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©æˆ zip åŒ…**
          asset_name: pfpanel-linux-executable.zip # Release Asset æ–‡ä»¶å
          asset_content_type: application/zip # Release Asset MIME ç±»å‹ (zip æ–‡ä»¶)
          overwrite: true # **æ–°å¢ï¼šå…è®¸è¦†ç›–å·²å­˜åœ¨çš„åŒå Asset**

      - name: Zip executable for release # å°†å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©æˆ zip åŒ…
        run: |
          cd dist
          zip -r pfpanel.zip pfpanel # å°† dist/pfpanel æ–‡ä»¶å¤¹å‹ç¼©æˆ pfpanel.zip
